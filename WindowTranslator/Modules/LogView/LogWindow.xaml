<ui:FluentWindow
    x:Class="WindowTranslator.Modules.LogView.LogWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:behaviors="clr-namespace:WindowTranslator.Behaviors"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:local="clr-namespace:WindowTranslator.Modules.LogView"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:properties="clr-namespace:WindowTranslator.Properties"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="{x:Static properties:Resources.Log}"
    Width="800"
    Height="450"
    d:DataContext="{d:DesignInstance {x:Type local:LogViewModel}}"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    ExtendsContentIntoTitleBar="True"
    WindowBackdropType="Mica"
    WindowCornerPreference="Default"
    mc:Ignorable="d">
    <ui:FluentWindow.Resources>
        <SolidColorBrush x:Key="SystemFillColorAttentionBrush" Color="{DynamicResource SystemFillColorAttention}" />
    </ui:FluentWindow.Resources>
    <Grid>
        <DockPanel>
            <ui:TitleBar DockPanel.Dock="Top">
                <ui:TitleBar.Icon>
                    <ui:ImageIcon Source="/wt.ico" />
                </ui:TitleBar.Icon>
                <ui:TitleBar.Header>
                    <Menu DockPanel.Dock="Top">
                        <Menu.Resources>
                            <Style BasedOn="{StaticResource {x:Type ui:MenuItem}}" TargetType="ui:MenuItem">
                                <Setter Property="MinWidth" Value="120" />
                            </Style>
                        </Menu.Resources>
                        <ui:MenuItem
                            Command="{Binding ExportLogsCommand}"
                            Header="{x:Static properties:Resources.Export}"
                            Icon="{ui:SymbolIcon Symbol=Save24}" />
                        <ui:MenuItem
                            Command="{Binding ClearLogsCommand}"
                            Header="{x:Static properties:Resources.Clear}"
                            Icon="{ui:SymbolIcon Symbol=Eraser24}" />
                    </Menu>
                </ui:TitleBar.Header>
                <ui:TitleBar.TrailingContent>
                    <ui:ToggleSwitch
                        x:Name="IsAutoScrollEnabled"
                        Margin="4"
                        Content="{x:Static properties:Resources.AutoScroll}"
                        IsChecked="True" />
                </ui:TitleBar.TrailingContent>
            </ui:TitleBar>
            <ui:ListView
                x:Name="LogListView"
                ItemsSource="{Binding Logs}"
                VirtualizingStackPanel.IsVirtualizing="True"
                VirtualizingStackPanel.VirtualizationMode="Recycling">
                <i:Interaction.Behaviors>
                    <behaviors:ScrollToEndBehavior IsAutoScrollEnabled="{Binding IsChecked, ElementName=IsAutoScrollEnabled, Mode=OneWay}" />
                </i:Interaction.Behaviors>
                <ui:ListView.View>
                    <ui:GridView>
                        <GridViewColumn
                            Width="140"
                            DisplayMemberBinding="{Binding Timestamp, StringFormat='{}{0:yyyy/MM/dd HH:mm:ss}'}"
                            Header="時刻" />
                        <GridViewColumn
                            Width="70"
                            DisplayMemberBinding="{Binding Level}"
                            Header="レベル" />
                        <GridViewColumn
                            Width="200"
                            DisplayMemberBinding="{Binding Category}"
                            Header="カテゴリ" />
                        <GridViewColumn
                            Width="400"
                            DisplayMemberBinding="{Binding FormattedMessage}"
                            Header="メッセージ" />
                    </ui:GridView>
                </ui:ListView.View>
                <ui:ListView.ItemContainerStyle>
                    <Style BasedOn="{StaticResource {x:Type ui:ListViewItem}}" TargetType="ui:ListViewItem">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Level}" Value="Error">
                                <Setter Property="Foreground" Value="{ui:ThemeResource SystemFillColorCriticalBrush}" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Level}" Value="Critical">
                                <Setter Property="Foreground" Value="DarkRed" />
                                <Setter Property="FontWeight" Value="Bold" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Level}" Value="Warning">
                                <Setter Property="Foreground" Value="{ui:ThemeResource SystemFillColorCautionBrush}" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Level}" Value="Information">
                                <Setter Property="Foreground" Value="{DynamicResource SystemFillColorAttentionBrush}" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ui:ListView.ItemContainerStyle>
            </ui:ListView>
        </DockPanel>
        <ui:SnackbarPresenter x:Name="SnackbarPresenter" />
    </Grid>
</ui:FluentWindow>
